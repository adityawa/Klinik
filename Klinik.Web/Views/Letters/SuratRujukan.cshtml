@model Klinik.Entities.Letter.LabReferenceLetterModel

@{
    ViewBag.Title = "SuratRujukan";
}
@section Styles {
    <link href="~/Content/jquery-ui.css" rel="stylesheet" />
    <style>
        .form-horizontal .control-label {
            text-align: left;
        }
    </style>
}

<div class="col-md-12">

    <section class="panel">
        <header class="panel-heading">
            <div class="panel-actions">
                <a href="#" class="fa fa-caret-down"></a>
            </div>
            <div>
                <h5 class="panel-title">
                    @Klinik.Resources.UIMessages.LetterCreation
                </h5>
            </div>
        </header>
        <div class="panel-body">
            <form class="form-horizontal">

                <div class="form-group">
                    <label class="col-md-2 control-label" for="inputDefault">@Klinik.Resources.UIMessages.Patient</label>
                    <div class="col-md-3">
                        @Html.DatalistFor(x => x.ForPatient, new PatientDataList { Url = "/Loket/AllPatient" }, new { @id = "ddlPatient" })
                    </div>
                </div>

                <div class="form-group">
                    <label class="col-md-2 control-label" for="inputDefault">@Klinik.Resources.UIMessages.MedicalCekDate</label>
                    <div class="col-md-3">
                        @Html.DropDownListFor(x => x.FormMedicalID, (IEnumerable<SelectListItem>)ViewBag.FormMedicalIds, new { @class = "form-control", @id = "ddlFrmMedIds" })
                    </div>

                </div>
                <div class="form-group col-md-9">
                    <label control-label" for="inputDefault">Surat : </label>
                    <table class="table table-striped table-bordered">
                        <tr>
                            <td>
                                @Klinik.Resources.UIMessages.LabReferenceLetter
                            </td>
                            <td>
                                <button id="btnLabRefLtr" class="btn btn-info">Create</button>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                @Klinik.Resources.UIMessages.HealthBodyLetter
                            </td>
                            <td>
                                <button id="btnHealthBdLtr" class="btn btn-info">Create</button>
                            </td>

                        </tr>
                        <tr>
                            <td>
                                @Klinik.Resources.UIMessages.TakeMedicineReferenceLetter
                            </td>
                            <td>
                                <button id="btntakeMedRefLtr" class="btn btn-info">Create</button>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                @Klinik.Resources.UIMessages.MedicalActionAcceptanceLetter
                            </td>
                            <td>
                                <button id="btnAcceptMedRefLtr" class="btn btn-info">Create</button>
                            </td>
                        </tr>
                    </table>
                </div>
            </form>

        </div>
    </section>
</div>

<div id="pnlMedicalRef" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="myModalLabel">Surat Rujukan Lab Keluar</h3>
            </div>

            <div class="col-md-12" style="margin-top:13px">
                <div class="form-group col-md-6">
                    <label class="col-md-3 control-label" for="inputDefault">@Klinik.Resources.UIMessages.Name</label>
                    <div class="col-md-6">
                        <input type="text" disabled="disabled" class="form-control" id="tbNamePatient" />
                    </div>
                </div>

                <div class="form-group col-md-6">
                    <label class="col-md-3 control-label" for="inputDefault">@Klinik.Resources.UIMessages.Gender</label>
                    <div class="col-md-6">
                        <input type="text" disabled="disabled" class="form-control" id="tbGender" />
                    </div>
                </div>

                <div class="form-group col-md-6">
                    <label class="col-md-3 control-label" for="inputDefault">@Klinik.Resources.UIMessages.SAP</label>
                    <div class="col-md-6">
                        <input type="text" disabled="disabled" class="form-control" id="tbSAP" />
                    </div>
                </div>

                <div class="form-group col-md-6">
                    <label class="col-md-3 control-label" for="inputDefault">@Klinik.Resources.UIMessages.HPNumber</label>
                    <div class="col-md-6">
                        <input type="text" disabled="disabled" class="form-control" id="tbHP" />
                    </div>
                </div>

                <div class="form-group col-md-6">
                    <label class="col-md-3 control-label" for="inputDefault">@Klinik.Resources.UIMessages.Birthdate</label>
                    <div class="col-md-6">
                        <input type="text" disabled="disabled" class="form-control" id="tbTglLahir" />
                    </div>
                </div>

                <div class="form-group col-md-6">
                    <label class="col-md-3 control-label" for="inputDefault">@Klinik.Resources.UIMessages.DokterPengirim</label>
                    <div class="col-md-6">
                        <input type="text" class="form-control" id="tbDokterPengirim" />
                    </div>
                </div>

                <div class="form-group col-md-6">
                    <label class="col-md-3 control-label" for="inputDefault">@Klinik.Resources.UIMessages.Age</label>
                    <div class="col-md-6">
                        <input type="text" disabled="disabled" class="form-control" id="tbUsia" />
                    </div>
                </div>

                <div class="form-group col-md-6">
                    <label class="col-md-3 control-label" for="inputDefault">@Klinik.Resources.UIMessages.MedicalCekDate</label>
                    <div class="col-md-6">
                        <input type="text" class="form-control" id="tbTglPeriksa" />
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary">Save changes</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/Scripts/jquery-ui.js"></script>
    <script src="~/Scripts/MvcDatalist/mvc-datalist.js"></script>
    <script>
        var _PatientId;
        [].forEach.call(document.getElementsByClassName('datalist'), function (element) {
            new MvcDatalist(element);
        });

        new MvcDatalist(document.querySelector('.datalist'), {
            events: {
                select: function (data, triggerChanges) {
                    for (var i = 0; i < data.length; i++) {
                        _PatientId = data[i].Id;
                    }

                    GetDateCheckUp(_PatientId);
                }
            }
        });

        $(function () {
            toastr.options = {
                "closeButton": true,
                "positionClass": "toast-top-full-width",
                "onclick": null,
                "showDuration": "0",
                "hideDuration": "0",
                "timeOut": "0",
                "showMethod": "fadeIn"
            };
            $('#tbCekDate').datepicker({
                format: "dd/mm/yyyy",
                changeMonth: true,
                changeYear: true
            });

            $('#btnLabRefLtr').click(function (e) {
                e.preventDefault();
                if (window.FormData != undefined) {
                    var form_data = new FormData();
                    form_data.append("forPatient", _PatientId);
                    form_data.append("FormMedicalID", $('#ddlFrmMedIds').val());
                    form_data.append("TglPeriksa", $('#ddlFrmMedIds option:selected').text());
                    $.ajax({
                        url: '/Letters/CreateSuratRujukanLab',
                        type: 'POST',
                        contentType: false,
                        processData: false,
                        dataType: 'JSON',
                        data: form_data,
                        async: "true",
                        success: function (result) {
                            if (result.Status) {
                                //bind datatable
                                $('#pnlMedicalRef').modal({
                                    backdrop: 'static'
                                });
                            }
                            else {
                                toastr.error(result.Message);
                            }
                        }
                    });
                }
                else {
                    toastr.error("Your Browser is not support Form Data");
                }
                return false;
            });
        });

        function GetDateCheckUp(PatientId) {
            $.get("/Letters/GetTanggalPemeriksaan", { PatientId: PatientId }, function (data) {
                $("#ddlFrmMedIds").empty();
                $.each(data, function (index, row) {
                    $("#ddlFrmMedIds").append('<option value="' + row.FormMedicalID + '">' + row.TransactionDateStr + '</option>');

                });
            });
        }
    </script>
}